<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç™»é©ç†±ç¨½æŸ¥å›å ±ç³»çµ±</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { 
            background-color: #f0f2f5; 
            font-family: 'Noto Sans TC', sans-serif;
            padding-bottom: 80px; 
        }
        .container { max-width: 700px; margin-top: 20px; }
        
        /* å¡ç‰‡æ¨£å¼ç¾åŒ– */
        .card { border: none; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .card-header { 
            background: linear-gradient(45deg, #198754, #20c997); 
            color: white; 
            font-weight: bold; 
            border-radius: 12px 12px 0 0 !important; 
            padding: 15px;
        }
        
        /* è¡¨å–®é …ç›®åˆ—æ¨£å¼ */
        .item-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #eee;
        }
        .item-row:last-child { border-bottom: none; }
        .item-label { 
            font-size: 0.95rem; 
            color: #333; 
            padding-right: 15px;
            line-height: 1.4;
        }
        
        /* è¼¸å…¥æ¡†æ¨£å¼ - é‡é»ï¼šå¤§å­—é«”æ–¹ä¾¿é»æ“Š */
        .count-input { 
            width: 80px; 
            text-align: center; 
            font-size: 1.2rem; 
            font-weight: bold;
            border-radius: 8px;
        }

        /* çµ±è¨ˆå€å¡Š */
        .summary-box {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: white;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            padding: 10px 20px;
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-pills .nav-link.active { background-color: #198754; }
        .nav-pills .nav-link { color: #198754; }
    </style>
</head>
<body>

<div class="container">
    <h3 class="text-center mb-4 fw-bold text-dark">ğŸ¦Ÿ ç™»é©ç†±ç—…åª’èšŠå­³ç”Ÿæº<br>ç’°å¢ƒè¤‡æŸ¥ç´€éŒ„è¡¨</h3>

    <ul class="nav nav-pills nav-fill mb-4" id="myTab" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active fw-bold" id="input-tab" data-bs-toggle="tab" data-bs-target="#input-panel" type="button">ğŸ“ ç¾å ´ç¨½æŸ¥</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link fw-bold" id="query-tab" data-bs-toggle="tab" data-bs-target="#query-panel" type="button">ğŸ” æˆæœæŸ¥è©¢</button>
        </li>
    </ul>

    <div class="tab-content">
        <div class="tab-pane fade show active" id="input-panel">
            <form id="inspectionForm">
                
                <div class="card">
                    <div class="card-header">ğŸ“ åŸºæœ¬è³‡æ–™</div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-12">
                                <label class="form-label text-muted small">ç¨½æŸ¥æ—¥æœŸ</label>
                                <input type="date" class="form-control form-control-lg" id="checkDate" required>
                            </div>
                            <div class="col-12">
                                <label class="form-label text-muted small">ç¨½æŸ¥åœ°é» (å€/é‡Œ)</label>
                                <input type="text" class="form-control form-control-lg" id="location" placeholder="ä¾‹å¦‚ï¼šåŒ—å€ åŒ—é–€é‡Œ" required>
                            </div>
                            <div class="col-12">
                                <label class="form-label text-muted small">ç¨½æŸ¥äººå“¡å§“å</label>
                                <input type="text" class="form-control form-control-lg" id="inspectorName" placeholder="è«‹è¼¸å…¥å§“å" required>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">ä¸€ã€å®¤å¤–å †ç½®æˆ–å»¢æ£„å®¹å™¨</div>
                    <div class="card-body" id="part1_container">
                        </div>
                </div>

                <div class="card">
                    <div class="card-header bg-danger text-white" style="background: linear-gradient(45deg, #dc3545, #ff6b6b);">äºŒã€å®¤å…§å¤–ç©æ°´å®¹å™¨</div>
                    <div class="card-body" id="part2_container">
                        </div>
                </div>

                <div class="summary-box">
                    <div>
                        <small class="text-muted d-block">åˆ¤å®šçµæœ</small>
                        <span id="finalResult" class="fw-bold text-success" style="font-size: 1.2rem;">åˆæ ¼ âœ…</span>
                    </div>
                    <div class="text-end me-3">
                        <small class="text-muted d-block">åˆè¨ˆè™•æ•¸</small>
                        <span class="fw-bold">å»¢ <span id="totalWaste" class="text-primary">0</span> / æ°´ <span id="totalWater" class="text-danger">0</span></span>
                    </div>
                    <button type="submit" class="btn btn-success fw-bold px-4">æäº¤</button>
                </div>
                
                <div style="height: 60px;"></div>
            </form>
        </div>

        <div class="tab-pane fade" id="query-panel">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title mb-3">ğŸ” æœå°‹ç´€éŒ„</h5>
                    <div class="row g-2">
                        <div class="col-4">
                            <select class="form-select" id="queryType">
                                <option value="date">æ—¥æœŸ</option>
                                <option value="inspector">äººå“¡</option>
                            </select>
                        </div>
                        <div class="col-8">
                            <input type="text" class="form-control" id="queryValue" placeholder="è¼¸å…¥æ—¥æœŸæˆ–å§“å">
                        </div>
                        <div class="col-12 mt-2">
                            <button class="btn btn-primary w-100" onclick="performQuery()">é–‹å§‹æŸ¥è©¢</button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="queryResults" class="mt-3"></div>
            <div class="text-center mt-5">
                 <button class="btn btn-outline-secondary btn-sm" onclick="clearAllData()">ğŸ—‘ï¸ æ¸…é™¤æ‰€æœ‰æ¸¬è©¦è³‡æ–™</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="successModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content text-center">
      <div class="modal-body p-4">
        <div class="mb-3" style="font-size: 3rem;">ğŸ‰</div>
        <h4 class="fw-bold text-success mb-2">å›å ±æˆåŠŸï¼</h4>
        <p class="text-muted">è³‡æ–™å·²å„²å­˜è‡³ç³»çµ±ã€‚</p>
        <button type="button" class="btn btn-success w-100" data-bs-dismiss="modal">ç¢ºå®š</button>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    // å®šç¾©è¡¨å–®é …ç›® (å«ç·¨è™Ÿ)
    const itemsPart1 = [
        "1. ç©ºç“¶ã€ç©ºç½...ç­‰", 
        "2. ç”•ã€å£º (é™¶ç“·æ°´ç¼¸ç­‰)", 
        "3. é‹ã€å£ºã€å†·æ°£æ¥æ°´æ¡¶", 
        "4. æ¯å­ã€ç¢Ÿå­ã€ç›¤å­ã€ç¢—ã€ç ´è£‚ç£å™¨é¢ç›†", 
        "5. ç©ºä¿éº—é¾ã€é¦¬æ§½æ°´...ç­‰", 
        "6. æ¡¶å­ (éµæ¡¶ã€å¡‘è† æ¡¶ã€å¯µç‰©æ°´ç›¤)",
        "7. æ¤°å­æ®¼ã€æ¤°å­è‘‰æ²...ç­‰", 
        "8. å»¢è¼ªèƒ", 
        "9. å»¢å‚¢ä¿±", 
        "10. å»¢å¸†å¸ƒ", 
        "11. ç©ºåœ°æœªæ•´ç†", 
        "12. ç©ºå±‹æœªæ•´ç†", 
        "13. å…¶ä»– (ä»»ä½•å»¢æ£„çš„å®¹å™¨æˆ–é›œç‰©)"
    ];

    const itemsPart2 = [
        "1. æ’èŠ±å®¹å™¨ (èŠ±ç›†ã€èŠ±ç“¶ç­‰)", 
        "2. è²¯æ°´å®¹å™¨ (æ°´ç¼¸ã€è²¯æ°´æ§½ã€æ°´æ¡¶ç­‰)", 
        "3. ç©æ°´çš„åœ°ä¸‹å®¤",
        "4. è¼ªèƒæˆ–æ’æ°´ç®¡ã€æ°´å¡”", 
        "5. å†°ç®±é™¤éœœåº•ç›¤ (æ°´ç›¤)", 
        "6. ç›†æ ½æ¤ç‰©å¢Šç›¤ (æ°´ç›¤)",
        "7. å…¶ä»– (ç«¹ç­’ã€æ¨¹æ´ã€æºã€äººæ‰‹å­”è“‹)"
    ];

    // åˆå§‹åŒ–é é¢
    window.onload = function() {
        generateFormFields('part1_container', itemsPart1, 'p1');
        generateFormFields('part2_container', itemsPart2, 'p2');
        document.getElementById('checkDate').valueAsDate = new Date();
    };

    // å‹•æ…‹ç”¢ç”Ÿè¼¸å…¥æ¬„ä½ (æ”¹ç‚ºæ¸…å–®å¼ä½ˆå±€)
    function generateFormFields(containerId, items, prefix) {
        const container = document.getElementById(containerId);
        let html = '';
        items.forEach((item, index) => {
            html += `
                <div class="item-row">
                    <label class="item-label">${item}</label>
                    <input type="number" 
                           class="form-control count-input" 
                           data-group="${prefix}" 
                           placeholder="0" 
                           inputmode="numeric" 
                           pattern="[0-9]*"
                           onchange="calculateTotal()" 
                           onfocus="this.select()">
                </div>
            `;
        });
        container.innerHTML = html;
    }

    // è¨ˆç®—ç¸½æ•¸
    function calculateTotal() {
        let totalWaste = 0;
        let totalWater = 0;

        // éæ­·æ‰€æœ‰è¼¸å…¥æ¡†ï¼Œè‹¥ç‚ºç©ºå‰‡è¦–ç‚º0
        document.querySelectorAll('input[data-group="p1"]').forEach(el => totalWaste += Number(el.value || 0));
        document.querySelectorAll('input[data-group="p2"]').forEach(el => totalWater += Number(el.value || 0));

        // æ›´æ–°ä»‹é¢
        document.getElementById('totalWaste').innerText = totalWaste;
        document.getElementById('totalWater').innerText = totalWater;
        
        const resultSpan = document.getElementById('finalResult');
        // åªè¦æœ‰ä»»ä½•ä¸€å€‹æ•¸é‡å¤§æ–¼0ï¼Œå°±æ˜¯ä¸åˆæ ¼
        if (totalWater > 0 || totalWaste > 0) {
            resultSpan.innerHTML = "ä¸åˆæ ¼ <span style='font-size:1.5rem'>âŒ</span>";
            resultSpan.className = "fw-bold text-danger";
        } else {
            resultSpan.innerHTML = "åˆæ ¼ <span style='font-size:1.5rem'>âœ…</span>";
            resultSpan.className = "fw-bold text-success";
        }
    }

    // è¡¨å–®æäº¤è™•ç†
    document.getElementById('inspectionForm').addEventListener('submit', function(e) {
        e.preventDefault();

        const data = {
            id: Date.now(),
            date: document.getElementById('checkDate').value,
            location: document.getElementById('location').value,
            inspector: document.getElementById('inspectorName').value,
            wasteCount: document.getElementById('totalWaste').innerText,
            waterCount: document.getElementById('totalWater').innerText
        };

        let records = JSON.parse(localStorage.getItem('dengueRecords')) || [];
        records.push(data);
        localStorage.setItem('dengueRecords', JSON.stringify(records));

        // ä½¿ç”¨ Bootstrap Modal é¡¯ç¤ºæˆåŠŸè¨Šæ¯ (è§£æ±ºäº‚ç¢¼å•é¡Œ)
        const successModal = new bootstrap.Modal(document.getElementById('successModal'));
        successModal.show();

        // é‡ç½®è¡¨å–® (ä¿ç•™æ—¥æœŸå’Œåœ°é»ï¼Œé€šå¸¸ç¨½æŸ¥å“¡æœƒåœ¨åŒä¸€å€é€£çºŒæŸ¥)
        const currentDate = document.getElementById('checkDate').value;
        const currentLocation = document.getElementById('location').value;
        const currentInspector = document.getElementById('inspectorName').value;
        
        this.reset();
        
        // æ¢å¾©åŸºæœ¬è³‡æ–™
        document.getElementById('checkDate').value = currentDate;
        document.getElementById('location').value = currentLocation;
        document.getElementById('inspectorName').value = currentInspector;
        
        // é‡ç½®è¨ˆæ•¸é¡¯ç¤º
        calculateTotal();
    });

    // æŸ¥è©¢åŠŸèƒ½
    function performQuery() {
        const type = document.getElementById('queryType').value;
        const value = document.getElementById('queryValue').value.trim();
        const resultDiv = document.getElementById('queryResults');
        
        let records = JSON.parse(localStorage.getItem('dengueRecords')) || [];
        let filtered = [];

        if (!value) {
            filtered = records.reverse(); // æ²’è¼¸å…¥å‰‡é¡¯ç¤ºå…¨éƒ¨ (æ–°åˆ°èˆŠ)
        } else if (type === 'date') {
            filtered = records.filter(r => r.date === value);
        } else {
            filtered = records.filter(r => r.inspector.includes(value));
        }

        if (filtered.length === 0) {
            resultDiv.innerHTML = '<div class="alert alert-warning text-center">æŸ¥ç„¡è³‡æ–™</div>';
            return;
        }

        let html = '';
        filtered.forEach(r => {
            const isBad = (r.waterCount > 0 || r.wasteCount > 0);
            const statusIcon = isBad ? 'âŒ' : 'âœ…';
            const bgClass = isBad ? 'border-danger' : 'border-success';
            
            html += `
                <div class="card ${bgClass} mb-2">
                    <div class="card-body p-3">
                        <div class="d-flex justify-content-between">
                            <h6 class="fw-bold mb-1">${r.date} <small class="text-muted fw-normal">| ${r.inspector}</small></h6>
                            <span class="fs-5">${statusIcon}</span>
                        </div>
                        <div class="text-dark mb-2">ğŸ“ ${r.location}</div>
                        <div class="d-flex justify-content-between bg-light p-2 rounded">
                            <span>å»¢æ£„å®¹å™¨: <strong>${r.wasteCount}</strong></span>
                            <span class="${Number(r.waterCount) > 0 ? 'text-danger fw-bold' : ''}">ç©æ°´å®¹å™¨: <strong>${r.waterCount}</strong></span>
                        </div>
                    </div>
                </div>
            `;
        });
        resultDiv.innerHTML = html;
    }
    
    function clearAllData() {
        if(confirm("ç¢ºå®šè¦åˆªé™¤æ‰‹æ©Ÿå…§æ‰€æœ‰æ­·å²è³‡æ–™å—ï¼Ÿ")) {
            localStorage.removeItem('dengueRecords');
            document.getElementById('queryResults').innerHTML = '';
        }
    }
</script>

</body>
</html>
