<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç™»é©ç†±ç¨½æŸ¥å›å ±ç³»çµ±</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { 
            background-color: #f0f2f5; 
            font-family: 'Noto Sans TC', sans-serif;
            padding-bottom: 80px; 
        }
        .container { max-width: 700px; margin-top: 20px; }
        
        .card { border: none; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .card-header { 
            background: linear-gradient(45deg, #198754, #20c997); 
            color: white; 
            font-weight: bold; 
            border-radius: 12px 12px 0 0 !important; 
            padding: 15px;
        }
        
        .item-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #eee;
        }
        .item-row:last-child { border-bottom: none; }
        .item-label { 
            font-size: 0.95rem; 
            color: #333; 
            padding-right: 15px;
            line-height: 1.4;
        }
        
        .count-input { 
            width: 80px; 
            text-align: center; 
            font-size: 1.2rem; 
            font-weight: bold;
            border-radius: 8px;
        }

        .summary-box {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: white;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            padding: 10px 20px;
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-pills .nav-link.active { background-color: #198754; }
        .nav-pills .nav-link { color: #198754; }
    </style>
</head>
<body>

<div class="container">
    <h3 class="text-center mb-4 fw-bold text-dark">ğŸ¦Ÿ ç™»é©ç†±ç—…åª’èšŠå­³ç”Ÿæº<br>ç’°å¢ƒè¤‡æŸ¥ç´€éŒ„è¡¨</h3>

    <ul class="nav nav-pills nav-fill mb-4" id="myTab" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active fw-bold" id="input-tab" data-bs-toggle="tab" data-bs-target="#input-panel" type="button">ğŸ“ ç¾å ´ç¨½æŸ¥</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link fw-bold" id="query-tab" data-bs-toggle="tab" data-bs-target="#query-panel" type="button">ğŸ” æˆæœæŸ¥è©¢</button>
        </li>
    </ul>

    <div class="tab-content">
        <div class="tab-pane fade show active" id="input-panel">
            <form id="inspectionForm">
                
                <div class="card">
                    <div class="card-header">ğŸ“ åŸºæœ¬è³‡æ–™</div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-12">
                                <label class="form-label text-muted small">ç¨½æŸ¥æ—¥æœŸ</label>
                                <input type="date" class="form-control form-control-lg" id="checkDate" required>
                            </div>
                            
                            <div class="col-12">
                                <label class="form-label text-muted small">ç¨½æŸ¥åœ°é»</label>
                                <div class="row g-2">
                                    <div class="col-6">
                                        <select class="form-select form-select-lg" id="districtSelect" required onchange="updateVillages()">
                                            <option value="" disabled selected>é¸æ“‡å€</option>
                                            </select>
                                    </div>
                                    <div class="col-6">
                                        <select class="form-select form-select-lg" id="villageSelect" required>
                                            <option value="" disabled selected>é¸æ“‡é‡Œ</option>
                                            </select>
                                    </div>
                                    <div class="col-12">
                                        <input type="text" class="form-control" id="detailAddress" placeholder="è©³ç´°åœ°é» (å¦‚: å…¬åœ’è·¯123è™Ÿ)" required>
                                    </div>
                                </div>
                            </div>

                            <div class="col-12">
                                <label class="form-label text-muted small">ç¨½æŸ¥äººå“¡å§“å</label>
                                <input type="text" class="form-control form-control-lg" id="inspectorName" placeholder="å°å¼·/å°æ˜" required>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">ä¸€ã€å®¤å¤–å †ç½®æˆ–å»¢æ£„å®¹å™¨</div>
                    <div class="card-body" id="part1_container"></div>
                </div>

                <div class="card">
                    <div class="card-header bg-danger text-white" style="background: linear-gradient(45deg, #dc3545, #ff6b6b);">äºŒã€å®¤å…§å¤–ç©æ°´å®¹å™¨</div>
                    <div class="card-body" id="part2_container"></div>
                </div>

                <div class="summary-box">
                    <div>
                        <small class="text-muted d-block">åˆ¤å®šçµæœ</small>
                        <span id="finalResult" class="fw-bold text-success" style="font-size: 1.2rem;">åˆæ ¼ âœ…</span>
                    </div>
                    <div class="text-end me-3">
                        <small class="text-muted d-block">åˆè¨ˆè™•æ•¸</small>
                        <span class="fw-bold">å»¢ <span id="totalWaste" class="text-primary">0</span> / æ°´ <span id="totalWater" class="text-danger">0</span></span>
                    </div>
                    <button type="submit" class="btn btn-success fw-bold px-4">æäº¤</button>
                </div>
                
                <div style="height: 60px;"></div>
            </form>
        </div>

        <div class="tab-pane fade" id="query-panel">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title mb-3">ğŸ” æœå°‹ç´€éŒ„</h5>
                    
                    <div class="mb-3">
                        <select class="form-select form-select-lg" id="queryType" onchange="toggleQueryInputs()">
                            <option value="date">ğŸ“… ä¾æ—¥æœŸå€é–“æŸ¥è©¢</option>
                            <option value="inspector">ğŸ‘¤ ä¾äººå“¡å§“åæŸ¥è©¢</option>
                        </select>
                    </div>

                    <div id="dateQueryGroup" class="row g-2">
                        <div class="col-6">
                            <label class="small text-muted">é–‹å§‹æ—¥æœŸ</label>
                            <input type="date" class="form-control" id="startDate">
                        </div>
                        <div class="col-6">
                            <label class="small text-muted">çµæŸæ—¥æœŸ</label>
                            <input type="date" class="form-control" id="endDate">
                        </div>
                    </div>

                    <div id="inspectorQueryGroup" class="d-none">
                        <input type="text" class="form-control form-control-lg" id="queryInspectorValue" placeholder="è¼¸å…¥äººå“¡å§“å (å¦‚ï¼šå°å¼·)">
                    </div>

                    <button class="btn btn-primary w-100 mt-3 btn-lg" onclick="performQuery()">æŸ¥è©¢</button>
                </div>
            </div>

            <div id="queryResults" class="mt-3"></div>
            <div class="text-center mt-5">
                 <button class="btn btn-outline-secondary btn-sm" onclick="clearAllData()">ğŸ—‘ï¸ æ¸…é™¤æ‰€æœ‰æ¸¬è©¦è³‡æ–™</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="successModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content text-center">
      <div class="modal-body p-4">
        <div class="mb-3" style="font-size: 3rem;">ğŸ‰</div>
        <h4 class="fw-bold text-success mb-2">å›å ±æˆåŠŸï¼</h4>
        <p class="text-muted">è³‡æ–™å·²å„²å­˜è‡³ç³»çµ±ã€‚</p>
        <button type="button" class="btn btn-success w-100" data-bs-dismiss="modal">ç¢ºå®š</button>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    // --- å°å—å¸‚è¡Œæ”¿å€èˆ‡é‡Œåˆ¥è³‡æ–™ (ç¯„ä¾‹ï¼šåŒ—å€å®Œæ•´ï¼Œå…¶ä»–å€ç‚ºç¤ºæ„) ---
    // ä½ å¯ä»¥åœ¨æ­¤æ“´å……å…¶ä»–å€çš„é‡Œåˆ¥
    const tainanData = {
        "åŒ—å€": ["åŒ—é–€é‡Œ", "å¤§å…‰é‡Œ", "å¤§æ¸¯é‡Œ", "å¤§èˆˆé‡Œ", "å¤§è±é‡Œ", "å…ƒå¯¶é‡Œ", "æ–‡å…ƒé‡Œ", "æ–‡æˆé‡Œ", "æˆå¾·é‡Œ", "å®‰æ°‘é‡Œ", "å»¶å¹³é‡Œ", "æ±èˆˆé‡Œ", "é•·å‹é‡Œ", "é‡èˆˆé‡Œ", "æŒ¯èˆˆé‡Œ", "è¯å¾·é‡Œ", "é–‹å…ƒé‡Œ", "åŠ›è¡Œé‡Œ", "å°åŒ—é‡Œ", "ä¸­æ¨“é‡Œ", "ä»æ„›é‡Œ", "åŒ—è¯é‡Œ", "æ­£è¦ºé‡Œ", "ç«‹äººé‡Œ", "åˆèˆˆé‡Œ", "å’Œé †é‡Œ", "å…¬åœ’é‡Œ", "é•·æ¦®é‡Œ", "åœ‹èˆˆé‡Œ", "è¯èˆˆé‡Œ", "ç¦å¾·é‡Œ", "è³¢åŒ—é‡Œ", "è³´æ—ºé‡Œ"],
        "ä¸­è¥¿å€": ["èµ¤åµŒé‡Œ", "æ³•è¯é‡Œ", "å—é–€é‡Œ", "å—ç¾é‡Œ", "åŸéšé‡Œ", "éƒ¡ç‹é‡Œ", "é–‹å±±é‡Œ", "äº”æ¢æ¸¯é‡Œ", "å…Œæ‚…é‡Œ", "æ·ºè‰é‡Œ", "åºœå‰é‡Œ", "å—å» é‡Œ", "è¥¿æ¹–é‡Œ", "è¥¿è³¢é‡Œ", "å¤§æ¶¼é‡Œ", "å¤©åé‡Œ", "ä¸‰åˆé‡Œ", "å”å’Œé‡Œ", "æ°‘ç”Ÿé‡Œ", "è—¥ç‹é‡Œ"],
        "å®‰å¹³å€": ["å¹³é€šé‡Œ", "è‚²å¹³é‡Œ", "åœ‹å¹³é‡Œ", "è¯å¹³é‡Œ", "æ€¡å¹³é‡Œ", "å»ºå¹³é‡Œ", "å„„è¼‰é‡Œ", "é‡‘åŸé‡Œ", "æ¼å…‰é‡Œ", "è¥¿é–€é‡Œ", "æµ·é ­é‡Œ", "å¹³å®‰é‡Œ", "çŸ³é–€é‡Œ", "æ¸¯ä»”é‡Œ", "æ–‡å¹³é‡Œ"],
        "æ±å€": ["èŠæ•¬é‡Œ", "æ±å…‰é‡Œ", "å´‡å­¸é‡Œ", "å´‡æ˜é‡Œ", "å´‡å–„é‡Œ", "å´‡å¾·é‡Œ", "å´‡æˆé‡Œ", "å´‡æ–‡é‡Œ", "å´‡ä¿¡é‡Œ", "å¾·å…‰é‡Œ", "å¤§åŒé‡Œ", "æ³‰å—é‡Œ", "é¾å±±é‡Œ", "è·¯æ±é‡Œ", "å¿ å­é‡Œ", "å¤§å¾·é‡Œ", "å¤§ç¦é‡Œ", "å¯Œå¼·é‡Œ", "å¯Œè£•é‡Œ", "æ–°æ±é‡Œ", "é—œè–é‡Œ", "å—è–é‡Œ", "æ±è–é‡Œ", "å¾©èˆˆé‡Œ", "è£•è–é‡Œ", "è™å°¾é‡Œ", "è‡ªå¼·é‡Œ", "å’Œå¹³é‡Œ", "å¾Œç”²é‡Œ", "æ±é–€é‡Œ", "åœä¸‹é‡Œ", "ä¸­è¥¿é‡Œ", "æˆå¤§é‡Œ", "å¤§å­¸é‡Œ", "å°æ±é‡Œ", "æ±æ˜é‡Œ", "æ±æ™ºé‡Œ", "å¤§æ™ºé‡Œ", "è¡›åœ‹é‡Œ"],
        "å—å€": ["å—è¯é‡Œ", "å½°å—é‡Œ", "å…‰æ˜é‡Œ", "é‡‘è¯é‡Œ", "åœ‹å®…é‡Œ", "æ—¥æ–°é‡Œ", "ç™½é›ªé‡Œ", "é–‹å—é‡Œ", "æ–°æ˜Œé‡Œ", "æ–°èˆˆé‡Œ", "å»£å·é‡Œ", "åºœå—é‡Œ", "æ˜äº®é‡Œ", "æ˜èˆˆé‡Œ", "æ–‡è¯é‡Œ", "å†èˆˆé‡Œ", "å¤§æˆé‡Œ", "å¤§æ—é‡Œ", "å¤§å¿ é‡Œ", "å¤§æ©é‡Œ", "æ–°ç”Ÿé‡Œ", "ç«¹æºªé‡Œ", "å»ºå—é‡Œ", "çœèº¬é‡Œ", "èˆˆè¾²é‡Œ", "åŒå®‰é‡Œ", "ä½›å£‡é‡Œ", "æ°¸å¯§é‡Œ", "æ¾å®‰é‡Œ", "å–œåŒ—é‡Œ", "å–œæ±é‡Œ", "å–œå—é‡Œ", "é¯¤é¯“é‡Œ"],
        "æ°¸åº·å€": ["å¤§æ©‹é‡Œ", "è¥¿æ©‹é‡Œ", "å®‰åº·é‡Œ", "æ±æ©‹é‡Œ", "äº”ç‹é‡Œ", "ä¸‰åˆé‡Œ", "å…­åˆé‡Œ", "å‹åˆ©é‡Œ", "ä¸­èˆˆé‡Œ", "äºŒç‹é‡Œ", "å¾©èˆˆé‡Œ", "å¾©åœ‹é‡Œ", "å¾©è¯é‡Œ", "å»ºåœ‹é‡Œ", "ç¥æ´²é‡Œ", "å…‰å¾©é‡Œ", "ä¸­è¯é‡Œ", "åŒ—ç£é‡Œ", "å—ç£é‡Œ", "æ±ç£é‡Œ", "è¥¿ç£é‡Œ", "å´‘å±±é‡Œ", "ç¶²å¯®é‡Œ", "æ°¸åº·é‡Œ", "æ­£å¼·é‡Œ", "åŸ”åœ’é‡Œ", "çƒç«¹é‡Œ", "è”¦æ¾é‡Œ", "ä¸‰æ°‘é‡Œ", "å¡©è¡Œé‡Œ", "å¡©æ´²é‡Œ", "å¡©èˆˆé‡Œ", "ç”²é ‚é‡Œ", "å¤§ç£é‡Œ", "æ±ç£é‡Œ", "è¥¿å‹¢é‡Œ", "æ–°æ¨¹é‡Œ", "é¾åŸ”é‡Œ", "æ°¸æ˜é‡Œ", "ç‹è¡Œé‡Œ", "å°šé ‚é‡Œ"],
        // å…¶ä»–å€åŸŸåƒ…åˆ—å‡ºåç¨±ï¼Œè‹¥éœ€å®Œæ•´é‡Œåˆ¥å¯è‡ªè¡Œè¤‡è£½è²¼ä¸Š
        "æ–°ç‡Ÿå€": [], "é¹½æ°´å€": [], "ç™½æ²³å€": [], "æŸ³ç‡Ÿå€": [], "å¾Œå£å€": [], "æ±å±±å€": [], 
        "éº»è±†å€": [], "ä¸‹ç‡Ÿå€": [], "å…­ç”²å€": [], "å®˜ç”°å€": [], "å¤§å…§å€": [], "ä½³é‡Œå€": [], 
        "å­¸ç”²å€": [], "è¥¿æ¸¯å€": [], "ä¸ƒè‚¡å€": [], "å°‡è»å€": [], "åŒ—é–€å€": [], "æ–°åŒ–å€": [], 
        "å–„åŒ–å€": [], "æ–°å¸‚å€": [], "å®‰å®šå€": [], "å±±ä¸Šå€": [], "ç‰äº•å€": [], "æ¥ è¥¿å€": [], 
        "å—åŒ–å€": [], "å·¦é®å€": [], "ä»å¾·å€": [], "æ­¸ä»å€": [], "é—œå»Ÿå€": [], "é¾å´å€": [], 
        "å®‰å—å€": []
    };

    const itemsPart1 = [
        "1. ç©ºç“¶ã€ç©ºç½...ç­‰", "2. ç”•ã€å£º (é™¶ç“·æ°´ç¼¸ç­‰)", "3. é‹ã€å£ºã€å†·æ°£æ¥æ°´æ¡¶", 
        "4. æ¯å­ã€ç¢Ÿå­ã€ç›¤å­ã€ç¢—ã€ç ´è£‚ç£å™¨é¢ç›†", "5. ç©ºä¿éº—é¾ã€é¦¬æ§½æ°´...ç­‰", "6. æ¡¶å­ (éµæ¡¶ã€å¡‘è† æ¡¶ã€å¯µç‰©æ°´ç›¤)",
        "7. æ¤°å­æ®¼ã€æ¤°å­è‘‰æ²...ç­‰", "8. å»¢è¼ªèƒ", "9. å»¢å‚¢ä¿±", "10. å»¢å¸†å¸ƒ", 
        "11. ç©ºåœ°æœªæ•´ç†", "12. ç©ºå±‹æœªæ•´ç†", "13. å…¶ä»– (ä»»ä½•å»¢æ£„çš„å®¹å™¨æˆ–é›œç‰©)"
    ];

    const itemsPart2 = [
        "1. æ’èŠ±å®¹å™¨ (èŠ±ç›†ã€èŠ±ç“¶ç­‰)", "2. è²¯æ°´å®¹å™¨ (æ°´ç¼¸ã€è²¯æ°´æ§½ã€æ°´æ¡¶ç­‰)", "3. ç©æ°´çš„åœ°ä¸‹å®¤",
        "4. è¼ªèƒæˆ–æ’æ°´ç®¡ã€æ°´å¡”", "5. å†°ç®±é™¤éœœåº•ç›¤ (æ°´ç›¤)", "6. ç›†æ ½æ¤ç‰©å¢Šç›¤ (æ°´ç›¤)",
        "7. å…¶ä»– (ç«¹ç­’ã€æ¨¹æ´ã€æºã€äººæ‰‹å­”è“‹)"
    ];

    window.onload = function() {
        generateFormFields('part1_container', itemsPart1, 'p1');
        generateFormFields('part2_container', itemsPart2, 'p2');
        initLocationSelect();
        
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('checkDate').value = today;
        document.getElementById('startDate').value = today;
        document.getElementById('endDate').value = today;
    };

    // åˆå§‹åŒ–åœ°å€é¸å–®
    function initLocationSelect() {
        const districtSelect = document.getElementById('districtSelect');
        const districts = Object.keys(tainanData);
        
        districts.forEach(d => {
            const option = document.createElement('option');
            option.value = d;
            option.text = d;
            // é è¨­é¸ä¸­åŒ—å€ (ä¾æ“šä½¿ç”¨è€…é™„ä»¶)
            if(d === "åŒ—å€") option.selected = true;
            districtSelect.appendChild(option);
        });
        
        // åˆå§‹åŒ–é‡Œåˆ¥
        updateVillages();
    }

    // æ›´æ–°é‡Œåˆ¥é¸å–® (é€£å‹•é‚è¼¯)
    function updateVillages() {
        const district = document.getElementById('districtSelect').value;
        const villageSelect = document.getElementById('villageSelect');
        const villages = tainanData[district] || [];
        
        // æ¸…ç©ºèˆŠé¸é …
        villageSelect.innerHTML = '<option value="" disabled selected>é¸æ“‡é‡Œ</option>';
        
        if (villages.length === 0) {
            // è‹¥è©²å€æ²’æœ‰è³‡æ–™ (ä¾‹å¦‚æ–°ç‡Ÿå€åœ¨ç›®å‰ä»£ç¢¼ä¸­ç‚ºç©º)
            const option = document.createElement('option');
            option.text = "è‡ªè¡Œå¡«å¯«";
            villageSelect.appendChild(option);
        } else {
            villages.forEach(v => {
                const option = document.createElement('option');
                option.value = v;
                option.text = v;
                villageSelect.appendChild(option);
            });
        }
    }

    function generateFormFields(containerId, items, prefix) {
        const container = document.getElementById(containerId);
        let html = '';
        items.forEach((item, index) => {
            html += `
                <div class="item-row">
                    <label class="item-label">${item}</label>
                    <input type="number" class="form-control count-input" data-group="${prefix}" placeholder="0" inputmode="numeric" pattern="[0-9]*" onchange="calculateTotal()" onfocus="this.select()">
                </div>
            `;
        });
        container.innerHTML = html;
    }

    function calculateTotal() {
        let totalWaste = 0;
        let totalWater = 0;
        document.querySelectorAll('input[data-group="p1"]').forEach(el => totalWaste += Number(el.value || 0));
        document.querySelectorAll('input[data-group="p2"]').forEach(el => totalWater += Number(el.value || 0));

        document.getElementById('totalWaste').innerText = totalWaste;
        document.getElementById('totalWater').innerText = totalWater;
        
        const resultSpan = document.getElementById('finalResult');
        if (totalWater > 0 || totalWaste > 0) {
            resultSpan.innerHTML = "ä¸åˆæ ¼ <span style='font-size:1.5rem'>âŒ</span>";
            resultSpan.className = "fw-bold text-danger";
        } else {
            resultSpan.innerHTML = "åˆæ ¼ <span style='font-size:1.5rem'>âœ…</span>";
            resultSpan.className = "fw-bold text-success";
        }
    }

    document.getElementById('inspectionForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        // çµ„åˆå®Œæ•´åœ°å€
        const dist = document.getElementById('districtSelect').value;
        const vill = document.getElementById('villageSelect').value || "";
        const detail = document.getElementById('detailAddress').value;
        const fullLocation = `${dist} ${vill} ${detail}`;

        const data = {
            id: Date.now(),
            date: document.getElementById('checkDate').value,
            location: fullLocation, // å­˜å…¥çµ„åˆå¥½çš„åœ°å€
            inspector: document.getElementById('inspectorName').value,
            wasteCount: document.getElementById('totalWaste').innerText,
            waterCount: document.getElementById('totalWater').innerText
        };

        let records = JSON.parse(localStorage.getItem('dengueRecords')) || [];
        records.push(data);
        localStorage.setItem('dengueRecords', JSON.stringify(records));

        new bootstrap.Modal(document.getElementById('successModal')).show();

        // æäº¤å¾Œä¿ç•™åŸºæœ¬è³‡æ–™ (åŒ…æ‹¬é¸ä¸­çš„å€å’Œé‡Œ)
        const currentDate = document.getElementById('checkDate').value;
        const currentInspector = document.getElementById('inspectorName').value;
        
        // ä¿ç•™ç•¶å‰é¸çš„å€å’Œé‡Œ
        const currentDist = document.getElementById('districtSelect').value;
        const currentVill = document.getElementById('villageSelect').value;
        
        this.reset();
        
        // æ¢å¾©æ•¸å€¼
        document.getElementById('checkDate').value = currentDate;
        document.getElementById('inspectorName').value = currentInspector;
        document.getElementById('districtSelect').value = currentDist;
        
        // å› ç‚º reset() æœƒæ¸…æ‰é‡Œåˆ¥é¸å–®ï¼Œéœ€è¦é‡æ–°ç”¢ç”Ÿä¸¦é¸å–
        updateVillages();
        document.getElementById('villageSelect').value = currentVill;
        
        calculateTotal();
    });

    function toggleQueryInputs() {
        const type = document.getElementById('queryType').value;
        const dateGroup = document.getElementById('dateQueryGroup');
        const inspectorGroup = document.getElementById('inspectorQueryGroup');

        if (type === 'date') {
            dateGroup.classList.remove('d-none');
            inspectorGroup.classList.add('d-none');
        } else {
            dateGroup.classList.add('d-none');
            inspectorGroup.classList.remove('d-none');
        }
    }

    function performQuery() {
        const type = document.getElementById('queryType').value;
        const resultDiv = document.getElementById('queryResults');
        let records = JSON.parse(localStorage.getItem('dengueRecords')) || [];
        let filtered = [];

        if (type === 'date') {
            const start = document.getElementById('startDate').value;
            const end = document.getElementById('endDate').value;
            if (!start || !end) { alert("è«‹é¸æ“‡é–‹å§‹èˆ‡çµæŸæ—¥æœŸ"); return; }
            filtered = records.filter(r => r.date >= start && r.date <= end);
        } else {
            const value = document.getElementById('queryInspectorValue').value.trim();
            if (!value) { alert("è«‹è¼¸å…¥äººå“¡å§“å"); return; }
            filtered = records.filter(r => r.inspector.includes(value));
        }

        filtered.sort((a, b) => new Date(b.date) - new Date(a.date));

        if (filtered.length === 0) {
            resultDiv.innerHTML = '<div class="alert alert-warning text-center">æ­¤å€é–“æˆ–äººå“¡æŸ¥ç„¡è³‡æ–™</div>';
            return;
        }

        let html = '';
        let sumWaste = 0;
        let sumWater = 0;

        filtered.forEach(r => {
            sumWaste += Number(r.wasteCount);
            sumWater += Number(r.waterCount);
            const isBad = (r.waterCount > 0 || r.wasteCount > 0);
            const statusIcon = isBad ? 'âŒ' : 'âœ…';
            const bgClass = isBad ? 'border-danger' : 'border-success';
            
            html += `
                <div class="card ${bgClass} mb-2">
                    <div class="card-body p-3">
                        <div class="d-flex justify-content-between">
                            <h6 class="fw-bold mb-1">${r.date} <small class="text-muted fw-normal">| ${r.inspector}</small></h6>
                            <span class="fs-5">${statusIcon}</span>
                        </div>
                        <div class="text-dark mb-2">ğŸ“ ${r.location}</div>
                        <div class="d-flex justify-content-between bg-light p-2 rounded">
                            <span>å»¢æ£„: <strong>${r.wasteCount}</strong></span>
                            <span class="${Number(r.waterCount) > 0 ? 'text-danger fw-bold' : ''}">ç©æ°´: <strong>${r.waterCount}</strong></span>
                        </div>
                    </div>
                </div>
            `;
        });
        
        const summaryHeader = `
            <div class="alert alert-info py-2 mb-3">
                <div class="row text-center">
                    <div class="col-6">ç¸½ç­†æ•¸: <strong>${filtered.length}</strong></div>
                    <div class="col-6">ç©æ°´å®¹å™¨ç¸½è¨ˆ: <strong class="text-danger">${sumWater}</strong></div>
                </div>
            </div>
        `;

        resultDiv.innerHTML = summaryHeader + html;
    }
    
    function clearAllData() {
        if(confirm("ç¢ºå®šè¦åˆªé™¤æ‰‹æ©Ÿå…§æ‰€æœ‰æ­·å²è³‡æ–™å—ï¼Ÿ")) {
            localStorage.removeItem('dengueRecords');
            document.getElementById('queryResults').innerHTML = '';
        }
    }
</script>

</body>
</html>
